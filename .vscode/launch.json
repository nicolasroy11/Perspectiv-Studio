{
  "version": "0.2.0",
  "configurations": [
    // -----------------------------------------------------
    // Run current Python file
    // -----------------------------------------------------
    {
      "name": "Current File",
      "type": "debugpy",
      "request": "launch",
      "program": "${file}",
      "console": "integratedTerminal",
      "env": {
        "PYTHONPATH": "."
      }
    },

    // -----------------------------------------------------
    // BACKEND: Run Local Uvicorn
    // -----------------------------------------------------
    {
      "name": "Backend: Run Local",
      "type": "debugpy",
      "request": "launch",
      "module": "uvicorn",
      "args": [
        "main:app",
        "--reload",
        "--host", "127.0.0.1",
        "--port", "8000"
      ],
      "cwd": "${workspaceFolder}/web/trader_backend",
      "console": "integratedTerminal",
      "env": {
        "PYTHONPATH": "${workspaceFolder}"
      }
    },

    // -----------------------------------------------------
    // FRONTEND: Local Dev (Vite)
    // -----------------------------------------------------
    {
      "name": "Frontend: Run Local Dev",
      "type": "node-terminal",
      "request": "launch",
      "cwd": "${workspaceFolder}/web/client",
      "command": "npm run dev"
    },

    // -----------------------------------------------------
    // FRONTEND: Dev + Auto-open Browser
    // -----------------------------------------------------
    {
      "name": "Frontend: Dev + Browser",
      "type": "node-terminal",
      "request": "launch",
      "cwd": "${workspaceFolder}/web/client",
      "command": "npm run dev",
      "env": {
        "BROWSER": "chrome"
      }
    },

    // -----------------------------------------------------
    // BACKEND: Build & Push Image of backend in its current state
    // -----------------------------------------------------
    {
      "name": "Backend: Build & Push Backend Image",
      "type": "PowerShell",
      "request": "launch",
      "script": "${workspaceFolder}/web/trader_backend/scripts/deploy-current-backend.ps1",
      "args": []
    },

    // -----------------------------------------------------
    // BACKEND: Docker Tag
    // -----------------------------------------------------
    {
      "name": "Backend: Docker Tag",
      "type": "node",
      "request": "launch",
      "preLaunchTask": "Backend: Docker Tag",
      "program": "${workspaceFolder}"
    },

    {
      "name": "Deploy Backend",
      "type": "node",
      "request": "launch",
      "preLaunchTask": "Deploy Backend",
      "program": "${workspaceFolder}"
    },

    // -----------------------------------------------------
    // BACKEND: Login to ECR
    // -----------------------------------------------------
    {
      "name": "Backend: ECR Login",
      "type": "node-terminal",
      "request": "launch",
      "command": "aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 451747690945.dkr.ecr.us-west-2.amazonaws.com"
    },

    // -----------------------------------------------------
    // BACKEND: Docker Push
    // -----------------------------------------------------
    {
      "name": "Backend: Docker Push",
      "type": "node-terminal",
      "request": "launch",
      "command": "docker push 451747690945.dkr.ecr.us-west-2.amazonaws.com/perspectiv-trader-backend:latest"
    },

    // -----------------------------------------------------
    // TERRAFORM: PLAN
    // -----------------------------------------------------
    {
      "name": "Terraform: Plan",
      "type": "node-terminal",
      "request": "launch",
      "command": "terraform plan",
      "cwd": "${workspaceFolder}/web/terraform"
    },

    // -----------------------------------------------------
    // TERRAFORM: APPLY
    // -----------------------------------------------------
    {
      "name": "Terraform: Apply",
      "type": "node-terminal",
      "request": "launch",
      "command": "terraform apply -auto-approve",
      "cwd": "${workspaceFolder}/web/terraform"
    },

    // -----------------------------------------------------
    // FRONTEND: BUILD
    // -----------------------------------------------------
    {
      "name": "Frontend: Build",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run build",
      "cwd": "${workspaceFolder}/web/client"
    },

    // -----------------------------------------------------
    // FRONTEND: Deploy to S3
    // -----------------------------------------------------
    {
      "name": "Frontend: Deploy to S3",
      "type": "node-terminal",
      "request": "launch",
      "command": "aws s3 sync web/client/build/ s3://perspectiv-trader-frontend/ --delete"
    },

    // -----------------------------------------------------
    // FRONTEND: CloudFront Invalidate
    // -----------------------------------------------------
    {
      "name": "Frontend: CloudFront Invalidate",
      "type": "node-terminal",
      "request": "launch",
      "command": "aws cloudfront create-invalidation --distribution-id EA2NQB5LVOJGQ --paths /*"
    },

    // -----------------------------------------------------
    // EC2: SSH
    // -----------------------------------------------------
    {
      "name": "EC2 SSH",
      "type": "node-terminal",
      "request": "launch",
      "command": "ssh -i ${env:USERPROFILE}\\.ssh\\perspectiv-main-key.pem ec2-user@44.234.85.114"
    },

    // -----------------------------------------------------
    // EC2: Tail Docker Logs
    // -----------------------------------------------------
    {
      "name": "EC2: Tail Backend Logs",
      "type": "node-terminal",
      "request": "launch",
      "command": "ssh -i ${env:USERPROFILE}\\.ssh\\perspectiv-main-key.pem ec2-user@44.234.85.114 \"docker logs $(docker ps -q) -f\""
    }
  ]
}
